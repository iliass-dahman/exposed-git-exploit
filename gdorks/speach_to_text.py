import threading
import wget
from pydub import AudioSegment
import speech_recognition as sr


def mp3_wav(path,id):
    mp3 = AudioSegment.from_mp3(path)
    mp3.export("audio"+str(id)+".wav", format="wav")

def convert_audio(audio_link):
    threadId = threading.get_ident()
    wget.download(audio_link, "audio"+str(threadId)+".mp3")
    print("Audio downloaded")
    mp3_wav("audio"+str(threadId)+".mp3",threadId)
    recognizer = sr.Recognizer()
    try:
        with sr.AudioFile("audio"+str(threadId)+".wav") as source:
            audio = recognizer.record(source)
            text = recognizer.recognize_google(audio)
        return text
    except (Exception ) as e:
        print("Audio not converted")
        print(e)
        return ""



