import math
import os

from pydub import AudioSegment

from gdorks.mp3_wav import mp3_wav


def mp3_list_to_wav():
    for filename in os.listdir(os.path.join(os.curdir, "originals")):
        file = os.path.join(os.path.join(os.curdir, "originals"), filename)
        mp3_wav(file)


def noise_up(filename: str):
    import librosa
    import numpy as np
    import statistics
    import soundfile
    signal, sample_rate = librosa.load(filename)
    signal_square_mean = statistics.mean(np.power(signal, 2))
    noise_standard_deviation = math.sqrt(signal_square_mean)
    signal_with_noise = signal + np.random.normal(0, noise_standard_deviation, signal.shape[0])
    soundfile.write("." + "".join(filename.split(".")[:-1]) + "noised.wav", signal_with_noise, sample_rate)
    return "." + "".join(filename.split(".")[:-1]) + "noised.wav"

