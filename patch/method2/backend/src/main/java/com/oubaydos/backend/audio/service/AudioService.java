package com.oubaydos.backend.audio.service;


import lombok.AllArgsConstructor;
import lombok.extern.log4j.Log4j2;
import org.apache.commons.io.IOUtils;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;

@Service
@Transactional
@AllArgsConstructor
@Log4j2
public class AudioService {

    private static final String AUDIO_PATH = "/test.wav";
    private TokenService tokenService;

    public byte[] getAudioFile(String id) throws IOException, IllegalAccessException {
        if (!tokenService.isValid(id)) throw new IllegalAccessException("YOU ARE A BOT HAHA");
        InputStream inputStream = new FileInputStream(AUDIO_PATH);
        tokenService.incrementCount(id);
        return IOUtils.toByteArray(inputStream);
    }

}